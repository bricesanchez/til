<!DOCTYPE html><html><head><meta charset="utf-8" /><title>Blog — Today Icelab Learnt</title><link href="/assets/public.css" rel="stylesheet" type="text/css" /><script src="/assets/public.js" type="text/javascript"></script></head><body><h1><a href="/">Today Icelab Learnt</a></h1><div class="blog"><h1><a href="/setting-cookies-in-request-specs/">Setting cookies in request specs</a></h1><div class="content" data-view-highlight=""><p>When writing request specs and you want to set a cookie, setting it with Capybara doesn’t seem to work, best to set it in the request headers.</p>

<p>Sad panda:</p>

<pre><code class="ruby">Capybara.current_session.driver.browser.set_cookie(&quot;really_useful_cookie=#{cookie_monster.id}&quot;)
</code></pre>

<p>Happy panda:</p>

<pre><code class="ruby">get some_path, {}, {“HTTP_COOKIE” =&gt; &quot;really_useful_cookie=#{cookie_monster.id}”}
</code></pre>
</div><div class="tags"><a href="/tags/testing">testing</a></div><h1><a href="/postgres-listen-notify/">PostgreSQL as a message bus</a></h1><div class="content" data-view-highlight=""><p>PostgreSQL has its own listen/notify mechanism. It might be useful for cases when we have to manage messaging between different application processes, but would prefer to not use extra dependencies such as Redis.</p>

<p><em>process.rb</em></p>

<pre><code>CHANNEL       = &quot;slack_bot&quot;
RESET_CHANNEL = &quot;pg_restart&quot;

ActiveRecord::Base.connection_pool.with_connection do |connection|
  conn = connection.instance_variable_get(:@connection)
  begin
    conn.async_exec &quot;LISTEN #{RESET_CHANNEL}&quot;
    conn.async_exec &quot;LISTEN #{CHANNEL}&quot;
    catch(:break_loop) do
      loop do
        conn.wait_for_notify do |channel, pid, payload|
          p [channel, payload]
          throw :break_loop if channel == RESET_CHANNEL
        end
      end
    end
  rescue =&gt; error
    p [:error, error]
  ensure
    conn.async_exec &quot;UNLISTEN *&quot;
  end
end
</code></pre>

<p><em>another-process.rb</em></p>

<pre><code>User.connection.execute %Q(NOTIFY &quot;slack_bot&quot;, params)
</code></pre>
</div><div class="tags"><a href="/tags/rails">rails</a>, <a href="/tags/postgres">postgres</a></div><h1><a href="/manually-add-sitemaps-to-googles-webmaster-tools/">Manually add sitemaps to Google’s Webmaster Tools</a></h1><div class="content" data-view-highlight=""><p>It’s good practice to add sitemaps to <a href="https://www.google.com/webmasters/tools/">Google’s Webmaster Tools</a> so you can check their health and get notifications about sitemap issues. We often host sitemaps on S3 because they could be large static files that we don’t want running through our Rails stack.</p>

<p>This leads us to the problem: If you have a sitemap that’s hosted externally to your website, you can’t add them through the Google’s Webmaster Tools interface. For some reason Google limits these to paths underneath the official domain attached to an account. There is a solution though — you can sneak them in using their notification URL. All you need to do is:</p>

<pre><code>curl www.google.com/webmasters/tools/ping?sitemap=https%3A%2F%2Fwheeler-centre-heracles.s3.amazonaws.com%2Fsitemaps%2Fsitemap.xml.gz
</code></pre>

<p>And ta da, it’ll show up in the Webmaster Tools admin interface.</p>
</div><div class="tags"><a href="/tags/seo">seo</a></div><h1><a href="/show-opengraph-image-on-first-facebook-share/">Show Open Graph image on first Facebook share</a></h1><div class="content" data-view-highlight=""><p>When you share a URL on Facebook for the first time — specifically, the first time <em>anyone</em> has shared it — it won’t include any of the images on the page and our clients will be :cry:. This happens even if you have included a meta tag that references an image:</p>

<pre><code class="html">&lt;meta property=&quot;og:image&quot; content=&quot;http://foo.com/image.png&quot;&gt;
</code></pre>

<p>The <em>second</em> time a URL is shared, it’ll work as expected and your chosen <code>og:image</code> will show up in the share preview (along with any other images on the page) — Facebook seem to have shifted this all to a background job or something.</p>

<p>Fear not! There is a solution. If you include the dimensions of your image alongside the <code>og:image</code> meta tag it’ll force Facebook to show the image immediately:</p>

<pre><code class="html">&lt;meta property=&quot;og:image&quot; content=&quot;http://foo.com/image.png&quot;&gt;
&lt;meta property=&quot;og:image:width&quot; content=&quot;300&quot;&gt;
&lt;meta property=&quot;og:image:height&quot; content=&quot;400&quot;&gt;
</code></pre>

<p>These dimensions don’t actually have to be accurate either. On Readings we don’t know the dimensions of images as they’re provided by Erudite without any meta-information, so we do a best-guess approach based on the ratio that book covers (or CD covers) tend to be.</p>
</div><div class="tags"><a href="/tags/social">social</a></div><h1><a href="/pushing-all-branches/">Pushing all branches</a></h1><div class="content" data-view-highlight=""><p>Say you want to push up an existing repostiory to a new remote on your favourite repository hosting service. You can use the following command if you want to make sure you include all branches:</p>

<pre><code>git push &lt;REMOTE-NAME&gt; --all
</code></pre>

<p>This is especially helpful when you want to immediately create some PRs!</p>

<p>To push all tags:</p>

<pre><code>git push &lt;REMOTE-NAME&gt; --tags
</code></pre>
</div><div class="tags"><a href="/tags/git">git</a></div><h1><a href="/clear-facebook-share-data/">Facebook image display when posting a link</a></h1><div class="content" data-view-highlight=""><p>When sharing links to Facebook, Kinderling were only being given the option to display old images, and couldn’t work out why the new ones weren’t coming through.</p>

<p>As it happens, there are specific metatags required to force Facebook to notice the correct content, explained <a href="https://developers.facebook.com/docs/sharing/webmasters#markup">here</a>.</p>

<p>“Without these tags, the Facebook Crawler will use internal heuristics to make a best guess about the title, description, and preview image for your content.”</p>

<p>To force refresh of a particular item without updating the site itself, you can also use the <a href="https://developers.facebook.com/tools/debug/og/object/">Facebook debugger</a>.</p>

<p>If you go there, input the URL and click “Fetch new scrape information” until the “right” content shows up at the bottom.</p>
</div><div class="tags"><a href="/tags/social">social</a></div><h1><a href="/css-dropdown-menus/">CSS dropdown menus</a></h1><div class="content" data-view-highlight=""><p>Creating a CSS-only dropdown menu is easy!</p>

<p><img src="/images/images/css-dropdown-menus.gif" alt="CSS dropdown menus are the bomb" /></p>

<p>Using nested lists, the basic structure is:</p>

<pre><code class="slim">ul.nav
  li.nav__list-item
    a.nav__list-anchor href=&quot;#&quot;
      | Hogwarts
  li.nav__list-item.nav__list-item--has-dropdown
    span.nav__list-toggle
      | Students
      i.fa.fa-caret-down
    ul.nav__dropdown
      li.nav__dropdown-list-item
        a.nav__dropdown-list-anchor href=&quot;#&quot;
          | Harry Potter
      li.nav__dropdown-list-item
        a.nav__dropdown-list-anchor href=&quot;#&quot;
          | Ron Weasley
      li.nav__dropdown-list-item
        a.nav__dropdown-list-anchor href=&quot;#&quot;
          | Hermione Granger
  li.nav__list-item.nav__list-item--has-dropdown
    span.nav__list-toggle
      | Teachers
      i.fa.fa-caret-down
    ul.nav__dropdown
      li.nav__dropdown-list-item
        a.nav__dropdown-list-anchor href=&quot;#&quot;
          | Minerva McGonagall
      li.nav__dropdown-list-item
        a.nav__dropdown-list-anchor href=&quot;#&quot;
          | Severus Snape
</code></pre>

<p>And the bare-bones CSS:</p>

<pre><code class="css">.nav__list-item {
  display: inline-block;
  position: relative;
}

  .nav__list-anchor,
  .nav__list-toggle {
    cursor: pointer;
    display: block;
  }

    .nav__dropdown {
      display: none;
      position: absolute;
      z-index: 2;
    }
    .nav__list-item--has-dropdown:hover .nav__dropdown,
    .nav__list-item--has-dropdown:focus .nav__dropdown {
      display: block;
    }

      .nav__dropdown-list-anchor {
        display: block;
      }
</code></pre>

<h2 id="consider-mobile">Consider mobile</h2>

<p><code>:hover</code> triggered menus don&rsquo;t feel <em>great</em> on mobile. A nice solution is to use a JavaScript <code>click</code> event to append a modifier class to the the toggle element (<code>.nav__list-anchor--dropdown-is-visible</code>) and use that class to perma-show the menu.</p>
</div><div class="tags"><a href="/tags/css">css</a></div><h1><a href="/table-columns-should-be-typed/">Table columns should be typed</a></h1><div class="content" data-view-highlight=""><p>Processing.Table columns should be typed as INT or FLOAT if you want to do maths with them:</p>

<pre><code>table.addColumn(&quot;name&quot;); // defaults to STRING
table.addColumn(&quot;count&quot;, Table.INT);
table.addColumn(&quot;height&quot;, Table.FLOAT);
</code></pre>

<p>If you <em>don&rsquo;t</em> do that, trying to cast the value on the way out:</p>

<pre><code>inst.getFloat(&quot;total&quot;)+1);
</code></pre>

<p>Seems like it&rsquo;d work. Nope.</p>

<p>(Processing 2.2.1)</p>
</div><div class="tags"><a href="/tags/processing">processing</a></div><h1><a href="/displaying-booleans-in-active-admin/">Displaying booleans in Active Admin</a></h1><div class="content" data-view-highlight=""><p>In Active Admin if you want to display a boolean propetry that doesn&rsquo;t directly map to a database column you can use <code>status_tag</code> to display the value in a fiendly way:</p>

<pre><code>column :featured do |thing|
  thing.featured? ? status_tag(&quot;yes&quot;, :ok) : status_tag(&quot;no&quot;)
end
</code></pre>

<p>There&rsquo;s a bit more info in the <em><a href="http://activeadmin.info/docs/12-arbre-components.html#status-tag">Active Admin docs</a></em> which shows you how to add classes too!</p>
</div><div class="tags"><a href="/tags/rails">rails</a>, <a href="/tags/ruby">ruby</a></div><h1><a href="/namespaced-components/">Using namespaced components in React</a></h1><div class="content" data-view-highlight=""><p>The last time I used React we had some pretty awkward workarounds for the fact that components couldn&rsquo;t be namespaced. I was pretty stoked to find this has been fixed now.</p>

<p>So if you have a component <code>myNavComponent</code> you can do:</p>

<pre><code>var NavComponent = React.createClass(...);
</code></pre>

<p>Define your sub-components as attributes:</p>

<pre><code>NavComponent.Next = React.createClass(...);
NavComponent.Prev = React.createClass(...);
NavComponent.Goto = React.createClass(...);
</code></pre>

<pre><code>var Nav = NavComponent;
</code></pre>

<p>And then use them as you would expect to in your JSX:</p>

<pre><code>&lt;Nav&gt;
  &lt;Nav.Prev /&gt;
  &lt;Nav.Goto /&gt;
  &lt;Nav.Next /&gt;
&lt;/Nav&gt;
</code></pre>

<p><a href="https://facebook.github.io/react/docs/jsx-in-depth.html#namespaced-components">https://facebook.github.io/react/docs/jsx-in-depth.html#namespaced-components</a></p>
</div><div class="tags"><a href="/tags/react">react</a>, <a href="/tags/js">js</a></div></div><a href="/">Previous page</a><p>Page 2 of 3</p><a href="/page/3/">Next page</a><div class="tags"><h2>All tags</h2><a href="/tags/react">react</a><a href="/tags/js">js</a><a href="/tags/ruby">ruby</a><a href="/tags/aws">aws</a><a href="/tags/accessibility">accessibility</a><a href="/tags/social">social</a><a href="/tags/performance">performance</a><a href="/tags/git">git</a><a href="/tags/css">css</a><a href="/tags/rails">rails</a><a href="/tags/slim">slim</a><a href="/tags/seo">seo</a><a href="/tags/postgres">postgres</a><a href="/tags/debugging">debugging</a><a href="/tags/testing">testing</a><a href="/tags/processing">processing</a></div></body></html>